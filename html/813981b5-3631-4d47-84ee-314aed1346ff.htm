<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-zh-CN.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>模型驱动架构</title><meta name="Language" content="zh-cn" /><meta name="Microsoft.Help.Id" content="813981b5-3631-4d47-84ee-314aed1346ff" /><meta name="Description" content="为了实现整个程序的可配置性，框架使用了模型驱动架构（Model Driven Architecture，MDA）的架构思想。" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Rafy User Guide<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy User Guide" tocid="roottoc">Rafy User Guide</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy框架" tocid="69b641cf-d1fe-4f06-877f-b479d268a3fc">Rafy框架</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="3ebafad8-73e3-431f-9e49-9a0d9b23c786.htm" title="设计理念" tocid="3ebafad8-73e3-431f-9e49-9a0d9b23c786">设计理念</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="853673c9-7c40-4679-b139-a3e7e3cec8ef.htm" title="领域驱动设计" tocid="853673c9-7c40-4679-b139-a3e7e3cec8ef">领域驱动设计</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="e1014057-fd62-4810-8f1f-333d54564e91.htm" title="面向服务架构" tocid="e1014057-fd62-4810-8f1f-333d54564e91">面向服务架构</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="15c790a6-8f5e-44aa-b8c3-74a955004a1e.htm" title="插件化架构" tocid="15c790a6-8f5e-44aa-b8c3-74a955004a1e">插件化架构</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="813981b5-3631-4d47-84ee-314aed1346ff.htm" title="模型驱动架构" tocid="813981b5-3631-4d47-84ee-314aed1346ff">模型驱动架构</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="946c540b-acb0-4531-b99c-85756cb69d4e.htm" title="产品线工程" tocid="946c540b-acb0-4531-b99c-85756cb69d4e">产品线工程</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn">模型驱动架构</td></tr></table><span class="introStyle"></span><div class="introduction"><p>为了实现整个程序的可配置性，框架使用了模型驱动架构（Model Driven Architecture，MDA）的架构思想。</p><p>Rafy 中，框架就是各类元数据，它们包括：领域实体元数据、界面元数据、ORM 元数据、其它零散元数据。与其它 MDA 的平台的不同在于，这些元数据完全由内存对象表示，并没有用 Xml 持久化。而这些元数据的配置，也主要是由代码进行配置（只有少部分元数据支持 Xml 配置），这样就使得开发人员可以封装更高级的配置函数，提高了开发效率。</p><p>本文包含以下章节：</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#em">领域实体元数据、ORM 元数据</a></li><li class="outlineSectionEntry"><a href="#evm">界面元数据</a></li><li class="outlineSectionEntry"><a href="#rafyMDA">Rafy 模型驱动架构</a></li><li class="outlineSectionEntry"><a href="#mda">附 - 模型驱动架构</a></li><li class="outlineSectionEntry"><a href="#seeAlsoSection">相关</a></li></ul></div><div class="collapsibleAreaRegion" id="em"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />领域实体元数据、ORM 元数据</span></div><div id="ID1RBSection" class="collapsibleSection"><p>
                    领域实体元数据由类型 <span class="code">Rafy.MetaModel.EntityMeta</span> 表示。它是实体框架运行时的基础，通过对它的配置，可以使得不同的实体表现出不同的行为。
                </p><p>
                    ORM 元数据是由 <span class="code">EntityMeta</span> 中的一些属性表示的：<span class="code">EntityMeta.TableMeta</span>、<span class="code">EntityPropertyMeta.ColumnMeta</span> 等。
                </p><p>
                    对领域实体元数据及 ORM 元数据的配置，通过使用 <span class="code">Rafy.MetaModel.EntityConfig&lt;T&gt;</span> 类型来完成。例如：
                </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAAAEAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAAAEAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EAAAEAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAAAEAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-comment">/// &lt;summary&gt;</span>
<span class="highlight-comment">/// 仓库 配置类。</span>
<span class="highlight-comment">/// 负责 仓库 类的实体元数据、界面元数据的配置。</span>
<span class="highlight-comment">/// &lt;/summary&gt;</span>
<span class="highlight-keyword">internal</span> <span class="highlight-keyword">class</span> WarehouseConfig : JXCEntityConfig&lt;Warehouse&gt;
{
    <span class="highlight-comment">/// &lt;summary&gt;</span>
    <span class="highlight-comment">/// 配置实体的元数据</span>
    <span class="highlight-comment">/// &lt;/summary&gt;</span>
    <span class="highlight-keyword">protected</span> <span class="highlight-keyword">override</span> <span class="highlight-keyword">void</span> ConfigMeta()
    {
        <span class="highlight-comment">//启用客户端缓存。</span>
        Meta.EnableClientCache();

        <span class="highlight-comment">//配置实体的所有属性都映射到数据表中。</span>
        Meta.MapTable().MapAllProperties();
    }
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAAEAAA");</script></div><div class="collapsibleAreaRegion" id="evm"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />界面元数据</span></div><div id="ID2RBSection" class="collapsibleSection"><p>
                    界面元数据由类型 <span class="code">Rafy.MetaModel.View.EntityViewMeta</span> 表示（它的两个子类 <span class="code">Rafy.MetaModel.View.WPFEntityViewMeta</span> 及 <span class="code">Rafy.MetaModel.View.WebEntityViewMeta</span> 分别用于配置 WPF 界面及 Web 界面）。
                </p><p>它是界面生动生成框架的输入。通过配置界面元数据，可以控制生成不同的界面。</p><p>
                    对界面元数据的配置，通过使用 <span class="code">Rafy.MetaModel.WPFViewConfig&lt;T&gt;</span> 或 <span class="code">Rafy.MetaModel.WebViewConfig&lt;T&gt;</span> 类型来完成。例如：
                </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAAADAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAAADAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EAAADAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAAADAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-comment">/// &lt;summary&gt;</span>
<span class="highlight-comment">/// 货品的视图配置。</span>
<span class="highlight-comment">/// &lt;/summary&gt;</span>
<span class="highlight-keyword">internal</span> <span class="highlight-keyword">class</span> ProductWPFViewConfig : WPFViewConfig&lt;Product&gt;
{
    <span class="highlight-keyword">protected</span> <span class="highlight-keyword">override</span> <span class="highlight-keyword">void</span> ConfigView()
    {
        View.DomainName(<span class="highlight-literal">"商品"</span>).HasDelegate(Product.MingChengProperty);

        <span class="highlight-comment">//界面生成时，使用以下命令</span>
        View.UseDefaultCommands().UseCommands(<span class="highlight-keyword">typeof</span>(ResetProductAmountCommand));

        <span class="highlight-comment">//表单使用以下布局</span>
        View.UseDetailPanel&lt;ProductForm&gt;();

        <span class="highlight-comment">//表格中的属性，使用以下布局</span>
        <span class="highlight-keyword">using</span> (View.OrderProperties())
        {
            View.Property(Product.BianMaProperty)
                .HasLabel(<span class="highlight-literal">"编码"</span>).ShowIn(ShowInWhere.All).ShowInDetail(contentWidth: <span class="highlight-number">0.7</span>, columnSpan: <span class="highlight-number">2</span>);
            View.Property(Product.MingChengProperty)
                .HasLabel(<span class="highlight-literal">"名称"</span>).ShowIn(ShowInWhere.All).ShowInDetail(contentWidth: <span class="highlight-number">600</span>, columnSpan: <span class="highlight-number">2</span>);
            <span class="highlight-comment">//...</span>
        }
    }
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAADAAA");</script></div><div class="collapsibleAreaRegion" id="rafyMDA"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Rafy 模型驱动架构</span></div><div id="ID3RBSection" class="collapsibleSection"><p>下图是 Rafy 的多层结构图，在各层中，都有相应的元数据（应用模型）支撑。只有绿色的部分是需要开发人员编写的。</p><div class="mediaNear"><div class="caption">模型驱动架构</div><img alt="MDA RafyMDA" src="../media/MDA_RafyMDA.png" /></div></div><div class="collapsibleAreaRegion" id="mda"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID4RB')" onkeypress="SectionExpandCollapse_CheckKey('ID4RB', event)" tabindex="0"><img id="ID4RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />附 - 模型驱动架构</span></div><div id="ID4RBSection" class="collapsibleSection"><div class="mediaNear"><div class="caption">模型驱动架构</div><img alt="MDA Overview" src="../media/MDA_Overview.png" /></div><div class="mediaNear"><div class="caption">模型转换</div><img alt="MDA Transform" src="../media/MDA_Transform.png" /></div><div class="mediaNear"><div class="caption">三大模型</div><img alt="MDA Transform 2" src="../media/MDA_Transform2.png" /></div><div class="mediaNear"><div class="caption">代码生成</div><img alt="MDA Generate" src="../media/MDA_Generate.png" /></div><p>
                    关于模型驱动架构的详细概念，参考：《<a href="http://www.omg.org/mda/" target="_blank">MDA</a> 》。
                </p></div><div class="collapsibleAreaRegion" id="seeAlsoSection"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID5RB')" onkeypress="SectionExpandCollapse_CheckKey('ID5RB', event)" tabindex="0"><img id="ID5RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />相关</span></div><div id="ID5RBSection" class="collapsibleSection"><h4 class="subHeading">Other Resources</h4><div class="seeAlsoStyle"><a href="http://www.omg.org/mda/" target="_blank">MDA</a></div></div></div></div><div id="pageFooter" class="pageFooter">胡庆访 @版权所有，有问题请联系 9474649@qq.com。<div class="feedbackLink">有关这个主题的评论请发邮件到
        <a id="HT_MailLink" href="mailto:9474649%40qq.com?Subject=Rafy User Guide">发送反馈</a></div><script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>