<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-zh-CN.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>创建第一个程序</title><meta name="Language" content="zh-cn" /><meta name="Microsoft.Help.Id" content="fdbb7d56-393e-4e0b-b69f-995a50f513eb" /><meta name="Description" content="创建你的第一个 Rafy 应用程序" /><meta name="Microsoft.Help.ContentType" content="How To" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Rafy User Guide<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy User Guide" tocid="roottoc">Rafy User Guide</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy框架" tocid="69b641cf-d1fe-4f06-877f-b479d268a3fc">Rafy框架</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="c8e6cd25-c674-4cd1-9880-816d11f58eb8.htm" title="领域实体框架" tocid="c8e6cd25-c674-4cd1-9880-816d11f58eb8">领域实体框架</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="dda8ce30-3c9c-48c6-b162-2c447bf9112e.htm" title="快速试用" tocid="dda8ce30-3c9c-48c6-b162-2c447bf9112e">快速试用</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="fdbb7d56-393e-4e0b-b69f-995a50f513eb.htm" title="创建第一个程序" tocid="fdbb7d56-393e-4e0b-b69f-995a50f513eb">创建第一个程序</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="e62ba2ed-ba69-46d8-8f23-6111c25215f0.htm" title="如何：连接到 Sql Server 数据库" tocid="e62ba2ed-ba69-46d8-8f23-6111c25215f0">如何：连接到 Sql Server 数据库</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn">创建第一个程序</td></tr></table><span class="introStyle"></span><div class="introduction"><p>创建你的第一个 Rafy 应用程序</p><p>本文包含以下章节：</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#description">说明</a></li><li class="outlineSectionEntry"><a href="#prerequisites">环境</a></li><li class="outlineSectionEntry"><a href="#createDomainLibrary">建立领域实体程序集</a></li><li class="outlineSectionEntry"><a href="#addEntities">添加实体类</a></li><li class="outlineSectionEntry"><a href="#addConsoleApp">建立控制台程序集</a></li><li class="outlineSectionEntry"><a href="#useEntities">使用领域实体</a></li><li class="outlineSectionEntry"><a href="#seeAlsoSection">相关</a></li></ul></div><div class="collapsibleAreaRegion" id="description"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID0RB')" onkeypress="SectionExpandCollapse_CheckKey('ID0RB', event)" tabindex="0"><img id="ID0RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />说明</span></div><div id="ID0RBSection" class="collapsibleSection"><p>
                    通过完成本示例，你将学会如何建立一个领域实体程序集，并建立一个应用层程序使用这些领域实体，完成数据的增删改查。
                </p><p>
                    本示例使用 SQLCE 作为示例的数据库。你也可以使用其它的数据库，详情参见：
                    <a href="ef53c777-dd02-4a01-98c9-7dcc49489cec.htm">多数据库支持</a>。
                </p></div><div class="collapsibleAreaRegion" id="prerequisites"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />环境</span></div><div id="ID1RBSection" class="collapsibleSection"><p>
                    运行此示例需要安装以下组件：
                </p><ul><li><p>Visual Studio 2012</p></li><li><p><a href="61dd4914-8d8b-4488-857c-f83b553137d8.htm">Rafy SDK</a></p></li></ul></div><div class="collapsibleAreaRegion" id="createDomainLibrary"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />建立领域实体程序集</span></div><div id="ID2RBSection" class="collapsibleSection"><p>本节中，你将会为“进销存”管理系统建立一个对应名为 JXC 的领域实体程序集。</p><h3 class="procedureSubHeading">步骤</h3><div class="subSection"><ol><li><p>新建项目</p><p>点击新建项目，在 Visual C# 项目类型中找到“Rafy Domain Library”，名称中填入："JXC"，选择项目位置后，点击确定。</p><div class="mediaNear"><img alt="第一个程序01" src="../media/第一个程序01.png" /></div></li><li><p>
                                    这时，会弹出<span class="ui">添加项目</span>窗口。在此窗口中，填写实体命名空间为 JXC，点击确定。
                                </p><div class="mediaNear"><img alt="第一个程序02" src="../media/第一个程序02.png" /></div></li><li><p>文件检查</p><p>至此，VS 会创建一个名为 JXC 的解决方案，其中包含了一个名为 JXC 的 C# 程序集。如图：</p><div class="mediaNear"><img alt="第一个程序03" src="../media/第一个程序03.png" /></div><p>
                                    JXC 程序集中包含了以下内容： <span class="literal">Entities</span> 文件夹
                                </p><ul><li><p><span class="literal">/Entities/</span> 文件夹：用于存放所有实体类。
                                        </p></li><li><p><span class="literal">/Entities/JXCEntity.cs</span> ：将作为 JXC 领域空间下所有实体类的基类。参见：<a href="e9998e68-31e8-47d6-9e28-829aade5044e.htm">领域实体</a>。
                                        </p></li><li><p><span class="literal">/JXCPlugin.cs</span> ：领域插件主文件。参见：<a href="15c790a6-8f5e-44aa-b8c3-74a955004a1e.htm">插件化架构</a>。
                                        </p></li></ul><p>编译整个解决方案，提示编译成功。</p></li></ol></div></div><div class="collapsibleAreaRegion" id="addEntities"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID4RB')" onkeypress="SectionExpandCollapse_CheckKey('ID4RB', event)" tabindex="0"><img id="ID4RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />添加实体类</span></div><div id="ID4RBSection" class="collapsibleSection"><p>本节将会在领域项目中添加实体类：仓库实体。</p><h3 class="procedureSubHeading">步骤</h3><div class="subSection"><ol><li><p>添加领域实体类文件</p><p>
                                    在 <span class="literal">Entities</span> 文件夹上点击右键，选择添加-添加项，在弹出的 <span class="ui">添加项</span> 窗口中，选择 <span class="term">Rafy Domain Entity</span> 项，并在名称中输入：“Warehouse"。点击添加。如图：
                                </p><div class="mediaNear"><img alt="第一个程序04" src="../media/第一个程序04.png" /></div></li><li><p>
                                    这时，弹出 <span class="ui">添加领域实体</span> 窗口。修改 <span class="term">领域名称</span> 项为“仓库”，勾选：“同时生成仓库”（该选项会把实体的仓库也生成在同一个文件中），点击确定。如图：
                                </p><div class="mediaNear"><img alt="第一个程序05" src="../media/第一个程序05.png" /></div></li><li><p>在实体中添加一般属性</p><p>
                                    在打开的 <span class="literal">Warehouse.cs</span> 代码编辑器中，找到并展开 <span class="literal">一般属性</span> 代码区域。
                                    在这个区域块中，输入 <strong>RafyP</strong>，VisualStudio 会立刻显示以 RafyP 开头的代码段（相关内容，参见：<a href="6b3e8163-8516-4065-91f5-194491334343.htm">代码段</a>。）。
                                    如下图：
                                </p><div class="mediaNear"><img alt="第一个程序06" src="../media/第一个程序06.png" /></div><p>
                                    选择 RafyProperty，并按下 Tab 键。在生成的代码中录入类型为 <strong>string</strong>、名称为 <strong>Name</strong> 的属性。这时，会生成以下代码：
                                </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID3EAAABAAAEAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID3EAAABAAAEAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID3EAAABAAAEAAA');return false;" title="Copy">Copy</a></div></div><div id="ID3EAAABAAAEAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">public</span> <span class="highlight-keyword">static</span> <span class="highlight-keyword">readonly</span> Property&lt;<span class="highlight-keyword">string</span>&gt; NameProperty = P&lt;Warehouse&gt;.Register(e =&gt; e.Name);
<span class="highlight-comment">/// &lt;summary&gt;</span>
<span class="highlight-comment">/// 名称</span>
<span class="highlight-comment">/// &lt;/summary&gt;</span>
<span class="highlight-keyword">public</span> <span class="highlight-keyword">string</span> Name
{
    <span class="highlight-keyword">get</span> { <span class="highlight-keyword">return</span> <span class="highlight-keyword">this</span>.GetProperty(NameProperty); }
    <span class="highlight-keyword">set</span> { <span class="highlight-keyword">this</span>.SetProperty(NameProperty, <span class="highlight-keyword">value</span>); }
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID3EAAABAAAEAAA");</script></li><li><p>编译解决方案</p><p>这时，编译解决方案，提示成功。</p></li></ol></div></div><div class="collapsibleAreaRegion" id="addConsoleApp"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID5RB')" onkeypress="SectionExpandCollapse_CheckKey('ID5RB', event)" tabindex="0"><img id="ID5RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />建立控制台程序集</span></div><div id="ID5RBSection" class="collapsibleSection"><p>本节中，你将会创建一个控制台应用程序。它使用刚才创建的 JXC 的领域实体程序集，来实现与用户的交互。</p><h3 class="procedureSubHeading">步骤</h3><div class="subSection"><ol><li><p>新建项目</p><p>
                                    在解决方案中右键，点击添加-新的项目，在弹出的 <span class="ui">新建项目</span> 窗口中，在 Visual C# 项目类型中找到“Rafy Console App”，名称中填入："ConsoleApp"，点击确定。
                                </p><div class="mediaNear"><img alt="第一个程序07" src="../media/第一个程序07.png" /></div></li><li><p>
                                    这时，会弹出<span class="ui">添加项目</span>窗口。在此窗口中，填写实体命名空间为 JXC，点击确定。
                                </p><div class="mediaNear"><img alt="第一个程序08" src="../media/第一个程序08.png" /></div><p>添加的控制台项目中有以下文件/文件夹：</p><ul><li><p><span class="literal">/amd64/</span> 文件夹：64位机的 SQLCE 程序集。
                                        </p></li><li><p><span class="literal">/x86/</span> 文件夹：32位机的 SQLCE 程序集。
                                        </p></li><li><p><span class="literal">/App.config</span> 文件：应用程序配置文件，其中主要包含了 JXC 空间中领域实体所映射的数据库连接；以及 SQLCE 数据库相关配置。
                                        </p></li><li><p><span class="literal">/Program.cs</span> 文件：应用程序入口文件。
                                        </p></li></ul></li><li><p>在 ConsoleApp 项目中添加 JXC 实体项目的引用。</p></li><li><p>编译并运行解决方案</p><p>这时编译整个解决方案，会提示编译成功。</p><p>设置 ConsoleApp 为启动项目，按 Ctrl+F5 运行程序。程序成功运行。</p></li></ol></div><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Note" /> Note</th></tr><tr><td><p>
                        控制台项目只是一个示例，展示如何在应用程序中使用领域实体类。你可以在任意的应用程序中，添加与本项目类似的代码，也可以一样使用领域实体程序集。
                    </p><p>
                        另外，控制台项目模板是为了方便 SQLCE 数据库的使用而创建的。如果你使用的是 SqlServer，则只需要手动引用 Rafy 程序集，并启动领域项目即可。
                    </p></td></tr></table></div></div><div class="collapsibleAreaRegion" id="useEntities"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID6RB')" onkeypress="SectionExpandCollapse_CheckKey('ID6RB', event)" tabindex="0"><img id="ID6RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />使用领域实体</span></div><div id="ID6RBSection" class="collapsibleSection"><h3 class="procedureSubHeading">步骤</h3><div class="subSection"><ol><li><p>
                                    在主函数中 new DomainApp().Startup(); 代码行后加入以下代码：
                                </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID3EAAACAAACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID3EAAACAAACAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID3EAAACAAACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID3EAAACAAACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">var</span> repo = RF.ResolveInstance&lt;WarehouseRepository&gt;();
repo.Save(<span class="highlight-keyword">new</span> Warehouse { Name = <span class="highlight-literal">"Name"</span> });
<span class="highlight-keyword">var</span> items = repo.CountAll();
Console.WriteLine(<span class="highlight-literal">"实体存储成功，目前数据库中存在 {0} 条数据。"</span>, items);
<span class="highlight-keyword">var</span> list = repo.GetAll();
<span class="highlight-keyword">foreach</span> (<span class="highlight-keyword">var</span> item <span class="highlight-keyword">in</span> list)
{
    Console.WriteLine(item.Name);
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID3EAAACAAACAAA");</script></li><li><p>运行整个项目</p><p>控制台中输出目前数据库中存在的数据条数，以及所有仓库的名称。</p><p>多次运行项目，会发现数据库中的数据条数不断添加。</p></li><li><p>查看生成的数据库</p><p>Rafy 内置了数据库的同步功能，所以在整个研发过程中，可以不需要进行任何数据库的开发。</p><p>打开 /ConsoleApp/bin/Debug/Data/ 目录，可以看到已经生成了一个 JXC.sdf 文件，这是一个 SQLCE 4.0 的数据库文件。</p><p>有关数据库生成的相关内容，参见：<a href="b40cd779-ec8a-469d-82f5-bd99128561c4.htm">数据库同步功能</a>。</p><p>关于如何切换为使用 Sql Server 的相关内容，参见：<a href="e62ba2ed-ba69-46d8-8f23-6111c25215f0.htm">如何：连接到 Sql Server 数据库</a>。</p></li></ol></div></div><div class="collapsibleAreaRegion" id="seeAlsoSection"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID7RB')" onkeypress="SectionExpandCollapse_CheckKey('ID7RB', event)" tabindex="0"><img id="ID7RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />相关</span></div><div id="ID7RBSection" class="collapsibleSection"><h4 class="subHeading">Other Resources</h4><div class="seeAlsoStyle"><a href="e9998e68-31e8-47d6-9e28-829aade5044e.htm">领域实体</a></div><div class="seeAlsoStyle"><a href="ef53c777-dd02-4a01-98c9-7dcc49489cec.htm">多数据库支持</a></div><div class="seeAlsoStyle"><a href="6b3e8163-8516-4065-91f5-194491334343.htm">代码段</a></div></div></div></div><div id="pageFooter" class="pageFooter">有问题请联系 9474649@qq.com。<div class="feedbackLink">有关这个主题的评论请发邮件到
        <a id="HT_MailLink" href="mailto:9474649%40qq.com?Subject=Rafy User Guide">发送反馈</a></div><script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>