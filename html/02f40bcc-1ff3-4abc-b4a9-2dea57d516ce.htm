<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-zh-CN.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>通用查询条件(CommonQueryCriteria)</title><meta name="Language" content="zh-cn" /><meta name="Microsoft.Help.Id" content="02f40bcc-1ff3-4abc-b4a9-2dea57d516ce" /><meta name="Description" content="在应用开发过程中，有 80% 的场景下，开发者所需要的实体查询，查询条件中其实都是一些简单的属性匹配，又或是一些属性匹配的简单组合。Rafy 为这样的场景提供了更为方便使用的 API：CommonQueryCriteria。" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Rafy User Guide<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy User Guide" tocid="roottoc">Rafy User Guide</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy框架" tocid="69b641cf-d1fe-4f06-877f-b479d268a3fc">Rafy框架</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="c8e6cd25-c674-4cd1-9880-816d11f58eb8.htm" title="领域实体框架" tocid="c8e6cd25-c674-4cd1-9880-816d11f58eb8">领域实体框架</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="6b377084-3fc9-4bf6-94d7-bc9a42ed82a7.htm" title="实体仓库" tocid="6b377084-3fc9-4bf6-94d7-bc9a42ed82a7">实体仓库</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="59c80aec-c910-4880-b165-c3495ed5eb3e.htm" title="编写查询" tocid="59c80aec-c910-4880-b165-c3495ed5eb3e">编写查询</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="c7c6d07b-bb41-4590-a2a6-8b0b49ce1c0b.htm" title="Linq 查询" tocid="c7c6d07b-bb41-4590-a2a6-8b0b49ce1c0b">Linq 查询</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="6d65448c-b51b-4c9b-9500-f6b7a48b1188.htm" title="SqlTree 查询" tocid="6d65448c-b51b-4c9b-9500-f6b7a48b1188">SqlTree 查询</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="02f40bcc-1ff3-4abc-b4a9-2dea57d516ce.htm" title="通用查询条件(CommonQueryCriteria)" tocid="02f40bcc-1ff3-4abc-b4a9-2dea57d516ce">通用查询条件(CommonQueryCriteria)</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="c2eced2c-e434-4d53-a06d-fbc518fbddf5.htm" title="Sql 查询" tocid="c2eced2c-e434-4d53-a06d-fbc518fbddf5">Sql 查询</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="ae9a2512-1528-401a-ac4f-502304a7ae03.htm" title="分页查询" tocid="ae9a2512-1528-401a-ac4f-502304a7ae03">分页查询</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="3e3ee502-ecbb-417d-8fbf-fa24ec21e2bc.htm" title="贪婪加载" tocid="3e3ee502-ecbb-417d-8fbf-fa24ec21e2bc">贪婪加载</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="56b9e7bc-2656-4bde-95dd-69e71aeafc6a.htm" title="数据行数查询" tocid="56b9e7bc-2656-4bde-95dd-69e71aeafc6a">数据行数查询</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="55180b16-9fda-42a1-8c4f-27d037aeae76.htm" title="表格查询" tocid="55180b16-9fda-42a1-8c4f-27d037aeae76">表格查询</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn">通用查询条件(CommonQueryCriteria)</td></tr></table><span class="introStyle"></span><div class="introduction"><p>
                在应用开发过程中，有 80% 的场景下，开发者所需要的实体查询，查询条件中其实都是一些简单的属性匹配，又或是一些属性匹配的简单组合。Rafy 为这样的场景提供了更为方便使用的 API：<span class="code">CommonQueryCriteria</span>。
            </p><p>本文包含以下章节：</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#singleGroupMatch">属性匹配</a></li><li class="outlineSectionEntry"><a href="#multiGroupsMatch">使用多个属性匹配组进行查询</a></li><li class="outlineSectionEntry"><a href="#adv">相对于 Linq 查询的优势</a></li></ul></div><div class="collapsibleAreaRegion" id="singleGroupMatch"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />属性匹配</span></div><div id="ID1RBSection" class="collapsibleSection"><p>
                    在查询时，当需要使用一个或几个属性的限定匹配来进行查询时，我们可以通过 <span class="code">CommonQueryCriteria</span> 来使用以下方法进行快速查询。例如，以下查询实现了通过用户的编码的精确匹配来查询唯一指定的用户：
                </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAGADAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAGADAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EAGADAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAGADAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">public</span> User GetByCode(<span class="highlight-keyword">string</span> code)
{
    <span class="highlight-keyword">return</span> <span class="highlight-keyword">this</span>.GetFirstBy(<span class="highlight-keyword">new</span> CommonQueryCriteria
    {
        <span class="highlight-keyword">new</span> PropertyMatch(User.CodeProperty, PropertyOperator.Equal, code)
    });
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAGADAAA");</script><p>例如，以下查询实现同时通过用户名称的模糊匹配、年龄的精确匹配来查询一组用户（由于 Age 未指定 PropertyOperator，所以使用的是 Equal）：</p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAEADAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAEADAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EAEADAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAEADAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">public</span> UserList GetByNameAge(<span class="highlight-keyword">string</span> name, <span class="highlight-keyword">int</span> age)
{
    <span class="highlight-keyword">return</span> <span class="highlight-keyword">this</span>.GetBy(<span class="highlight-keyword">new</span> CommonQueryCriteria
    {
        <span class="highlight-keyword">new</span> PropertyMatch(User.NameProperty, PropertyOperator.Contains, name),
        <span class="highlight-keyword">new</span> PropertyMatch(User.AgeProperty, age)
    });
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAEADAAA");</script><p>
                    上述查询默认使用 And 进行多条件的连接。如果需要修改，可以通过 <span class="code">CommonQueryCriteria</span>
                    的构造器传入或属性进行设置。
                </p><p>PropertyOperator 表示属性匹配的方式，可用的操作有：</p><ul><li><p>Equal</p></li><li><p>
                            NotEqual
                        </p></li><li><p>
                            Greater
                        </p></li><li><p>
                            GreaterEqual
                        </p></li><li><p>
                            Less
                        </p></li><li><p>
                            LessEqual
                        </p></li><li><p>

                            Like
                        </p></li><li><p>
                            NotLike
                        </p></li><li><p>
                            Contains
                        </p></li><li><p>
                            NotContains
                        </p></li><li><p>
                            StartsWith
                        </p></li><li><p>
                            NotStartsWith
                        </p></li><li><p>
                            EndsWith
                        </p></li><li><p>
                            NotEndsWith
                        </p></li><li><p>
                            In
                        </p></li><li><p>
                            NotIn
                        </p></li></ul><div class="alert"><table><tr><th><img src="../icons/AlertNote.png" alt="Note" /> Note</th></tr><tr><td><p>
                        为了方便开发者使用 <span class="code">CommonQueryCriteria</span>，RafySDK 提供了代码段 <span class="code">RafyQuery_Common</span> 来生成上述代码。
                    </p></td></tr></table></div></div><div class="collapsibleAreaRegion" id="multiGroupsMatch"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />使用多个属性匹配组进行查询</span></div><div id="ID2RBSection" class="collapsibleSection"><p>上面是比较简单的查询，只是对单个属性或使用 And、Or 连接的几个条件进行匹配。我们还可以通过属性匹配组来实现相对复杂的查询。</p><p>
                    一个 <span class="code">CommonQueryCriteria</span> 中可以通过 And、Or 连接多个属性匹配组，而每一个属性匹配组也可以通过 And、Or 连接多个具体的属性匹配条件。
                </p><p>下面的代码演示了如何使用（'Name contains name' And 'Age equal age' Or 'Code equal code'）的条件进行查询：</p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAAACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAAACAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EAAACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAAACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">this</span>.GetBy(<span class="highlight-keyword">new</span> CommonQueryCriteria(BinaryOperator.Or)
{
    <span class="highlight-keyword">new</span> PropertyMatchGroup
    {
        <span class="highlight-keyword">new</span> PropertyMatch(TestUser.NameProperty, PropertyOperator.Contains, name)
        <span class="highlight-keyword">new</span> PropertyMatch(TestUser.AgeProperty, age)
    },
    <span class="highlight-keyword">new</span> PropertyMatchGroup
    {
        <span class="highlight-keyword">new</span> PropertyMatch(TestUser.CodeProperty, code)
    }
});</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAACAAA");</script></div><div class="collapsibleAreaRegion" id="adv"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />相对于 Linq 查询的优势</span></div><div id="ID3RBSection" class="collapsibleSection"><p>
                    使用 <span class="code">CommonQueryCriteria</span> 进行查询时，相对于 <a href="c7c6d07b-bb41-4590-a2a6-8b0b49ce1c0b.htm">Linq 查询</a> 而言，有以下的优势：
                </p><ul><li><p>更加方便、简单</p><p>仓库类型上已经提供了参数是 <span class="code">CommonQueryCriteria</span> 的公有查询方法，开发可以直接使用这些方法进行查询，没有必要再封装一个相应的公有方法。</p><p>例如，上面的示例中，也可以不封装 GetByCode 方法，而是由仓库的调用者直接使用 GetBy(CommonQueryCriteria) 方法。</p></li><li><p>性能更好</p><p>使用 Linq 查询时，编译器会使用反射生成表达式树，然后 Rafy 框架才会解析这棵树，生成最终的 Sql 树。但是使用 <span class="code">CommonQueryCriteria</span> 通用查询时，Rafy 框架会直接将 <span class="code">CommonQueryCriteria</span> 中的条件生成对应的 Sql 树，这就节省了表达式树的生成和解析的环节，提升了性能。</p></li></ul></div></div></div><div id="pageFooter" class="pageFooter">有问题请联系 9474649@qq.com。<div class="feedbackLink">有关这个主题的评论请发邮件到
        <a id="HT_MailLink" href="mailto:9474649%40qq.com?Subject=Rafy User Guide">发送反馈</a></div><script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>